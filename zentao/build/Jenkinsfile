import hudson.model.*;

println env.JENKINS_HOME
println env.JOB_NAME
println env.BUILD_NUMBER

pipeline {
    agent none
    parameters {
        string(
            description: 'Input artifactory user name.',
            name: 'ARTIFACTORY_USER',
            defaultValue: 'zenops-user',
        )
        string(
            description: 'Input artifactory user password.',
            name: 'ARTIFACTORY_PASSWORD',
            defaultValue: 'P2ssw0rd',
        )
        string(
            description: 'Input Git user name.',
            name: 'GIT_USER',
            defaultValue: 'chenqi',
        )
        string(
            description: 'Input Git user password.',
            name: 'GIT_TOKEN',
            defaultValue: 'zGx3WjkxphapoG4eeHjP',
        )

    }

    stages {
        stage("read yaml file") {
            agent { node { label 'build-server' } }
            steps{
                script{
                    yaml_file = "conf.yml"
                    model_test.read_yaml_file(yaml_file)
                }
            }
        }

// 	    stage('build image') {
// 	    	agent { node { label 'build-server' } }
// 		    steps {
// 		    	dir ('zentao/build') {
// 			        script {
// 			            echo 'download tools'
// 			            sh 'wget -P tool http://192.168.1.161:58082/artifactory/zentaopms/tool/yuicompressor.jar'
//
// 			            echo 'build docker image ...'
// 			            sh 'docker build \
// 			                --build-arg  ARTIFACTORY_USER=${ARTIFACTORY_USER} \
// 			                --build-arg  ARTIFACTORY_PASSWORD=${ARTIFACTORY_PASSWORD} \
// 			                --rm -t 192.168.1.161:59082/zenops/zentao-builder:latest .'
// 			        }
// 		        }
// 		    }
// 	    }
// 	    stage('push image') {
// 		    agent { node { label 'build-server' } }
// 			steps {
//                 echo 'upload docker image ...'
//
//                 sh 'docker login -u ${ARTIFACTORY_USER} -p ${ARTIFACTORY_PASSWORD} 192.168.1.161:59082'
//                 sh 'docker push 192.168.1.161:59082/zenops/zentao-builder:latest'
// 			}
// 	    }
	}
}
